<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>M-DVD:StopSpammer</id>
	<name>Stop Spammer</name>
	<version>2.3.9</version>



	<file name="SOURCEDIR/Register.php">
		<operation>
			<search position="after"><![CDATA[
	// Include the additional options that might have been filled in.]]></search>
			<add><![CDATA[
	// Is Spammer? Then should be approval
	if ($modSettings['stopspammer_enable'])
	{
		require_once($sourcedir . '/StopSpammer.php');
		if ($regOptions['spammer'] = checkDBSpammer($user_info['ip'], $_POST['user'], $_POST['email']))
		{
			$regOptions['require'] = 'approval';
			$modSettings['registration_method'] = 2;
			if ($regOptions['spammer'] != 8)
				updateSettings(array('stopspammer_count' => ++$modSettings['stopspammer_count']), true);
		}
	}
]]></add>
		</operation>
	</file>


<!-- let's see what to do about this

https://github.com/elkarte/Elkarte/blob/1ec92cff034aeae85d3cc51798a2f736dd6f9db5/sources/Load.php#L2729-L2731

	// Are there any members waiting for approval?
	if (allowedTo('moderate_forum') && ((!empty($modSettings['registration_method']) && $modSettings['registration_method'] == 2) || !empty($modSettings['approveAccountDeletion'])) && !empty($modSettings['unapprovedMembers']))
		$context['warning_controls']['unapproved_members'] = sprintf($txt[$modSettings['unapprovedMembers'] == 1 ? 'approve_one_member_waiting' : 'approve_many_members_waiting'], $scripturl . '?action=admin;area=viewmembers;sa=browse;type=approve', $modSettings['unapprovedMembers']);
-->

	<file name="SOURCEDIR/Subs.php">
		<operation>
			<search position="replace"><![CDATA[
			$context['unapproved_members'] = (!empty($modSettings['registration_method']) && $modSettings['registration_method'] == 2) || !empty($modSettings['approveAccountDeletion']) ? $modSettings['unapprovedMembers'] : 0;]]></search>
			<add><![CDATA[
			$context['unapproved_members'] = $modSettings['unapprovedMembers'];]]></add>
		</operation>
	</file>





	<file name="SOURCEDIR/Subs-Members.php">
		<operation>
			<search position="after"><![CDATA[
		'validation_code' => $validation_code,]]></search>
			<add><![CDATA[
		'is_spammer' => empty($regOptions['spammer']) ? 0 : $regOptions['spammer'],]]></add>
		</operation>


<!-- integrate_activate? -->
		<operation>
			<search position="replace"><![CDATA[
			mem.id_member, mem.member_name, mem.real_name, mem.email_address, mem.icq, mem.aim, mem.yim, mem.msn, mem.member_ip, mem.member_ip2, mem.last_login,]]></search>
			<add><![CDATA[
			mem.id_member, mem.member_name, mem.real_name, mem.email_address, mem.icq, mem.aim, mem.yim, mem.msn, mem.member_ip, mem.member_ip2, mem.last_login, mem.is_spammer,]]></add>
		</operation>
	</file>



</modification>
